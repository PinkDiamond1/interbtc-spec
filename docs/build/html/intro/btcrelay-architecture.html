

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>BTC-Relay Architecture &mdash; interBTC Specification  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Bitcoin Data Model" href="bitcoin.html" />
    <link rel="prev" title="XCLAIM Architecture" href="xclaim-architecture.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: grey" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> interBTC Specification
          

          
          </a>

          
            
            
              <div class="version">
                v5.5.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="at-a-glance.html">BTC Parachain at a Glance</a></li>
<li class="toctree-l1"><a class="reference internal" href="CbA.html">Cryptocurrency-backed Assets</a></li>
<li class="toctree-l1"><a class="reference internal" href="polkadot.html">Polkadot</a></li>
<li class="toctree-l1"><a class="reference internal" href="xclaim-architecture.html">XCLAIM Architecture</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">BTC-Relay Architecture</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#actors">Actors</a></li>
<li class="toctree-l2"><a class="reference internal" href="#components">Components</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#storage">Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#verification">Verification</a></li>
<li class="toctree-l3"><a class="reference internal" href="#utils">Utils</a></li>
<li class="toctree-l3"><a class="reference internal" href="#parser">Parser</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="bitcoin.html">Bitcoin Data Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="accepted-format.html">Accepted Bitcoin Transaction Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spec/introduction.html">How to Read This Specification</a></li>
</ul>
<p class="caption"><span class="caption-text">XCLAIM Specification</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../spec/collateral.html">Collateral</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spec/fee.html">Fee</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spec/oracle.html">Exchange Rate Oracle</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spec/issue.html">Issue</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spec/refund.html">Refund</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spec/redeem.html">Redeem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spec/replace.html">Replace</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spec/security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spec/relay.html">Relay</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spec/treasury.html">Treasury</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spec/vault-registry.html">Vault Registry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spec/nomination.html">Vault Nomination</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spec/reward.html">Reward</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spec/staking.html">Staking</a></li>
</ul>
<p class="caption"><span class="caption-text">BTC-Relay Specification</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../spec/btc-relay/data-model.html">Data Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spec/btc-relay/functions.html">Functions: Storage and Verification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spec/btc-relay/parser.html">Functions: Parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spec/btc-relay/helpers.html">Functions: Utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spec/btc-relay/events.html">Events</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spec/btc-relay/errors.html">Error Codes</a></li>
</ul>
<p class="caption"><span class="caption-text">Security and Performance</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../security_performance/liquidations.html">Vault Liquidations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security_performance/xclaim-security.html">XCLAIM Security Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security_performance/btcrelay-security.html">Security Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security_performance/performance.html">Performance Analysis</a></li>
</ul>
<p class="caption"><span class="caption-text">Economics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../economics/incentives.html">Economic Incentives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../economics/fees.html">Fee Model</a></li>
</ul>
<p class="caption"><span class="caption-text">All the rest</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../other/license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../other/interlay.html">Interlay</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">interBTC Specification</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>BTC-Relay Architecture</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/intro/btcrelay-architecture.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="btc-relay-architecture">
<h1>BTC-Relay Architecture<a class="headerlink" href="#btc-relay-architecture" title="Permalink to this headline">¶</a></h1>
<p>BTC-Relay is a key component of the BTC Parachain on Polkadot. Its main task is to allow the Parachain to verify the state of Bitcoin and react to transactions and events.
Specifically, BTC-Relay acts as a <a class="reference external" href="https://en.bitcoin.it/wiki/Scalability#Simplified_payment_verification">Bitcoin SPV/light client</a> on Polkadot, storing only Bitcoin block headers and allowing users to verify transaction inclusion proofs.
Further, it is able to handle forks and follows the chain with the most accumulated Proof-of-Work.</p>
<p>The correct operation of BTC-Relay is crucial: should BTC-Relay cease to operate, the bridge between Polkadot and Bitcoin is interrupted.</p>
<div class="figure align-default" id="id1">
<img alt="Overview of BTC-Relay as a component of the BTC Parachain" src="../_images/interBTC-btcrelay.png" />
<p class="caption"><span class="caption-number">Fig. 7 </span><span class="caption-text">BTC-Relay (highlighted in blue) is a key component of the BTC Parachain: it is necessary to verify and keep track of the state of Bitcoin.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<p>Below, we provide an overview of its components, as well as relevant actors - offering references to the full specification contained in the rest of this document.</p>
<div class="figure align-default" id="id2">
<img alt="BTC Parachain architecture diagram" src="../_images/btcrelay-architecture.png" />
<p class="caption"><span class="caption-number">Fig. 8 </span><span class="caption-text">Overview of the BTC-Relay architecture. Bitcoin block headers are submitted to the Verification Component, which interacts with the Utils, Parser and Failure Handling components, as well as the Parachain Storage.</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<div class="section" id="actors">
<h2>Actors<a class="headerlink" href="#actors" title="Permalink to this headline">¶</a></h2>
<p>BTC-Relay differentiates between the following actors:</p>
<ul class="simple">
<li><p><strong>Users</strong> - BTC Parachain users which interact with the BTC-Relay directly or with other modules which make calls to BTC-Relay.</p></li>
<li><p><strong>Staked Relayers</strong> - Staked Relayers lock up collateral in the BTC Parachain and are responsible for running Bitcoin <a class="reference external" href="https://bitcoin.org/en/full-node">full nodes</a> and verify that blocks submitted to BTC-Relay are valid (and that transactional data for these blocks is available).</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While any user can submit block headers to BTC-Relay, this role can be assigned to Staked Relayers, given these participants already run Bitcoin full nodes and check validity of stored blocks.</p>
</div>
<ul class="simple">
<li><p><strong>(Parachain) Governance Mechanism</strong> - the correct operation of the BTC Parachain, and hence of BTC-Relay, is overseen by the Parachain’s Governance Mechanism (e.g. committee of consensus participants and other key actors of the BTC Parachain).</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>At the time of writing, the exact composition of the Governance Mechanism / committee is not fully defined for the bridge. This specification assumes the existence and correct operation of this mechanism - although modifications may be necessary to accommodate complexities and additional functional requirements, once the Governance Mechanism is fully specified.</p>
</div>
</div>
<div class="section" id="components">
<h2>Components<a class="headerlink" href="#components" title="Permalink to this headline">¶</a></h2>
<div class="section" id="storage">
<h3>Storage<a class="headerlink" href="#storage" title="Permalink to this headline">¶</a></h3>
<p>This component stores the Bitcoin block headers and additional data structures, necessary for operating BTC-Relay. See <a class="reference internal" href="../spec/btc-relay/data-model.html#data-model"><span class="std std-ref">Data Model</span></a> for more details.</p>
</div>
<div class="section" id="verification">
<h3>Verification<a class="headerlink" href="#verification" title="Permalink to this headline">¶</a></h3>
<p>The Verification component offers functionality to verify Bitcoin block headers and transaction inclusion proofs. See <a class="reference internal" href="../spec/btc-relay/functions.html#storage-verification"><span class="std std-ref">Functions: Storage and Verification</span></a> for the full function specification.</p>
<p>In more detail, the verification component performs the operations of a <a class="reference external" href="https://bitcoin.org/en/operating-modes-guide#simplified-payment-verification-spv">Bitcoin SPV client</a>. See <a class="reference external" href="https://eprint.iacr.org/2018/643.pdf">this paper (Appendix D)</a> for a more detailed and formal discussion on the necessary functionality.</p>
<ul class="simple">
<li><p><em>Difficulty Adjustment</em> - check and keep track of Bitcoin’s difficulty adjustment mechanism, so as to be able to determine when the PoW difficulty target needs to be recomputed.</p></li>
<li><p><em>PoW Verification</em> - check that, given a 80 byte Bitcoin block header and its block hash, (i) the block header is indeed the pre-image to the hash and (ii) the PoW hash matches the difficulty target specified in the block header.</p></li>
<li><p><em>Chain Verification</em> - check that the block header references an existing block already stored in BTC-Relay.</p></li>
<li><p><em>Main Chain Detection / Fork Handling</em> - when given two conflicting Bitcoin chains, determine the <em>main chain</em>, i.e., the chain with the most accumulated PoW (longest chain in Bitcoin, though under consideration of the difficulty adjustment mechanism).</p></li>
<li><p><em>Transaction Inclusion Verification</em> - given a transaction, a reference to a block header, the transaction’s index in that block and a Merkle tree path, determine whether the transaction is indeed included in the specified block header (which in turn must be already verified and stored in the Bitcoin main chain tracked by BTC-Relay).</p></li>
</ul>
<p>An overview and explanation of the different classes of blockchain state verification in the context of cross-chain communication, specifically the difference between full validation of transactions and mere verification of their inclusion in the underlying blockchain, can be found <a class="reference external" href="https://eprint.iacr.org/2019/1128.pdf">in this paper (Section 5)</a>.</p>
</div>
<div class="section" id="utils">
<h3>Utils<a class="headerlink" href="#utils" title="Permalink to this headline">¶</a></h3>
<p>The Utils component provides “helper” functions used by the Storage and Verification components, such as the calculation of Bitcoin’s double SHA256 hash, or re-construction of Merkle trees. See <a class="reference internal" href="../spec/btc-relay/helpers.html#utils"><span class="std std-ref">Functions: Utils</span></a> for the full function specification.</p>
</div>
<div class="section" id="parser">
<h3>Parser<a class="headerlink" href="#parser" title="Permalink to this headline">¶</a></h3>
<p>The Parser component offers functions to parse Bitcoin’s block and transaction data structures, e.g. extracting the Merkle tree root from a block header or the OP_RETURN field from a transaction output. See <a class="reference internal" href="../spec/btc-relay/parser.html#parser"><span class="std std-ref">Functions: Parser</span></a> for the full function specification.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="bitcoin.html" class="btn btn-neutral float-right" title="Bitcoin Data Model" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="xclaim-architecture.html" class="btn btn-neutral float-left" title="XCLAIM Architecture" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2021, Interlay

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>